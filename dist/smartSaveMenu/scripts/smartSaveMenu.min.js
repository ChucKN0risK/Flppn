var userCollections,focus,smartSaveMenu=function(){this.$host=smartSaveMenuHost,this.$el=this.$host.shadowRoot.querySelector("#smartSaveMenu"),this.createCollectionInput=this.$el.querySelector("#createCollectionText"),this.categoriesList=this.$el.getElementsByTagName("ul")[0],this.isShown=!1,this.events()};smartSaveMenu.prototype={events:function(){var e=this;e.createCollectionInput.onkeypress=function(t){e.createCollection(t)};var t=e.$el.querySelector(".website-favicon");t.style.backgroundImage="url("+getFavicon()+")",document.body.addEventListener("click",function(t){e.isShown&&e.toggle()}),this.$el.onclick=function(e){e.preventDefault(),e.stopPropagation()},e.createCollectionInput.onfocus=function(e){e.preventDefault(),focus=!0},e.createCollectionInput.onblur=function(){focus=!1},document.onkeydown=function(t){t=t||window.event,27==t.keyCode&&e.isShown&&e.close()}},toggle:function(){this.isShown?this.close():this.open()},open:function(){this.$el.classList.add("is-open"),this.isShown=!0},close:function(){this.$el.classList.remove("is-open"),this.isShown=!1},getUserCollections:function(){var e=this;Array.isArray(userCollections)||getCollections(function(t,o){userCollections=o;for(var n=0;n<o.length;n++)e.categoriesList.appendChild(e.constructCategories(o[n]))})},assignCollections:function(){console.log("assignCollections")},createCollection:function(e){var t=this;e=e||window.event,13==e.keyCode&&(e.preventDefault(),createCollectionRequest(t.createCollectionInput.value,function(e,o){return e?console.log("errrrror",e):(o.success.numberVideo=o.success.videos.length,userCollections.push(o.success),t.createCollectionInput.value="",void t.saveVideo(o.success._id,function(e){o.success.videoNumber=1,o.success.img=e.default_thumb,t.categoriesList.appendChild(t.constructCategories(o.success))}))}))},saveVideo:function(e,t){var o="string"==typeof e?e:e.currentTarget.dataset.collectionid;smartSaveMenu.toggle(),addVideoRequest(window.location.href,o,function(e,o){return e?console.log("error save video",e):void(t&&t(o))})},constructCategories:function(e){var t=document.createElement("li");t.classList.add("smartSaveMenu-collection"),t.setAttribute("data-collectionID",e._id);var o=document.createElement("div");o.classList.add("collection-cover"),o.style.backgroundImage="url("+e.img+")";var n=document.createElement("div");n.classList.add("collection-content");var s=document.createElement("p");s.classList.add("collection-name");var i=document.createElement("p");return i.classList.add("collection-infos"),t.appendChild(o),t.appendChild(n),n.appendChild(s),"unClassified"===e.title&&(e.title="My Video"),s.appendChild(document.createTextNode(e.title)),n.appendChild(i),i.appendChild(document.createTextNode(e.videoNumber+" videos")),t.addEventListener("click",this.saveVideo),t}};var getFavicon=function(){for(var e=void 0,t=document.getElementsByTagName("link"),o=0;o<t.length;o++)"icon"!=t[o].getAttribute("rel")&&"shortcut icon"!=t[o].getAttribute("rel")||(e=t[o].getAttribute("href"));return e},xhr=new XMLHttpRequest;xhr.open("GET",chrome.extension.getURL("smartSaveMenu/smartSaveMenu.html"),!0),xhr.onload=function(){var e=document.createElement("div");e.style.zIndex="858575959",e.style.position="fixed",e.style.right="10px",e.style.bottom="10px",e.innerHTML=this.responseText,document.body.appendChild(e);var t=document.querySelector("#smartSaveMenuHost").createShadowRoot(),o=document.querySelector("#smartSaveMenuTemplate"),n=document.importNode(o.content,!0);t.appendChild(n),smartSaveMenu=new smartSaveMenu},xhr.send();