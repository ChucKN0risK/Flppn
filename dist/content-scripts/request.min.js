var urlAPI="http://ec2-54-154-184-39.eu-west-1.compute.amazonaws.com:8080",request=function(e,n,t,o){var u=new XMLHttpRequest;u.onload=function(){return 200!==u.status?o(JSON.parse(u.response)):void o(null,JSON.parse(u.response))},u.open(e,n,!0),u.setRequestHeader("Content-Type","application/json"),t.token&&u.setRequestHeader("Authorization",t.token),u.send(JSON.stringify(t.data))},getToken=function(e){chrome.storage.sync.get(function(n){return n.id_token?e(n.id_token):void login.toggle()})},getCollections=function(e){getToken(function(n){var t={token:n};request("GET",urlAPI+"/collections",t,function(n,t){return n?e(n):void e(null,t)})})},signin=function(e,n,t){var o={data:{pseudo:e,password:n}};request("POST",urlAPI+"/signin",o,function(e,n){return e?t(e):(chrome.storage.sync.set({id_token:n.id_token}),void t(null,n))})},createCollectionRequest=function(e,n){getToken(function(t){var o={token:t,data:{title:e}};request("POST",urlAPI+"/collection",o,function(e,t){return e?n(e):void n(null,t)})})},addVideoRequest=function(e,n,t){getToken(function(o){var u={token:o,data:{url:e}};n&&(u.data.collection=n),request("POST",urlAPI+"/video",u,function(e,n){return e?t(e):void t(null,n)})})};